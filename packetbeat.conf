input {
  beats {
    port => 5044
    type => "beats"
  }
}

filter {
  # Ensure client.ip exists before applying GeoIP
  if [client][ip] {
    geoip {
      source => "[client][ip]"
      target => "[client][geo]"
    }
  }
  
  # Classify network traffic based on protocol
  if [network][protocol] == "http" {
    mutate {
      add_tag => ["web_traffic"]
    }
  } else if [network][protocol] == "dns" {
    mutate {
      add_tag => ["dns_lookup"]
    }
  } else if [network][protocol] == "tls" {
    mutate {
      add_tag => ["tls_traffic"]
    }
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    user => "elastic"  # Replace with actual username
    password => "XZLMsIMk6J7rNo1qO38a"  # Replace with actual password
    index => "network-traffic-%{+YYYY.MM.dd}"
  }
  
  stdout {
    codec => rubydebug  # Helps in debugging logs
  }
}
